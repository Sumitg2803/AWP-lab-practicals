<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Responses - Portfolio Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4A90E2;
            --secondary-color: #2C3E50;
            --accent-color: #3498DB;
            --success-color: #27AE60;
            --warning-color: #F39C12;
            --danger-color: #E74C3C;
            --white: #FFFFFF;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }
        #root {
            padding: 0 1rem;
        }

        .admin-header {
            background: var(--white);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .admin-title {
            color: var(--secondary-color);
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .admin-subtitle {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--secondary-color);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .active-stat { color: var(--success-color); }
        .trash-stat { color: var(--danger-color); }
        .total-stat { color: var(--primary-color); }
        .today-stat { color: var(--warning-color); }

        .section-card {
            background: var(--white);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--secondary-color);
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary-color);
        }

        .table-container {
            overflow-x: auto;
        }

        .response-table {
            margin-bottom: 0;
        }

        .response-table th {
            background: var(--primary-color);
            color: var(--white);
            font-weight: 600;
            border: none;
        }

        .response-table td {
            vertical-align: middle;
            border-color: #eee;
        }

        .response-row {
            transition: all 0.3s ease;
        }

        .response-row:hover {
            background-color: #f8f9fa;
            transform: scale(1.01);
        }

        .message-preview {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
        }

        .message-preview:hover {
            color: var(--primary-color);
            text-decoration: underline;
        }

        .btn-action {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
            border-radius: 5px;
            margin: 0.1rem;
        }

        .btn-view { background: var(--primary-color); border: none; }
        .btn-reply { background: var(--success-color); border: none; }
        .btn-delete { background: var(--danger-color); border: none; }
        .btn-restore { background: var(--warning-color); border: none; }
        .btn-permanent { background: var(--secondary-color); border: none; }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--secondary-color);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .filter-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .quick-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .alert-custom {
            border-radius: 10px;
            border: none;
            font-weight: 500;
        }

        .navbar-admin {
            background: var(--secondary-color);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 2rem;
        }

        .navbar-admin .navbar-brand {
            color: var(--white);
            font-weight: 600;
        }

        .back-to-portfolio {
            color: var(--white);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        .back-to-portfolio:hover {
            background: rgba(255,255,255,0.1);
            color: var(--white);
        }

        @media (max-width: 768px) {
            .container-fluid {
                padding: 1rem;
            }
            
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .filter-controls {
                flex-direction: column;
            }
            
            .search-box {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div id="root" class="container-fluid"></div>

    <!-- React CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        const initialDemoData = [
            {
                id: '99999',
                name: 'Demo User',
                email: 'demo@example.com',
                subject: 'general',
                message: 'This is a sample message. New submissions from the contact form will appear here.',
                newsletter: true,
                timestamp: new Date().toLocaleString(),
                status: 'active'
            }
        ];

        // --- Helper Functions ---
        const formatDate = (dateString) => {
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        };

        const escapeHtml = (text) => {
            if (typeof text !== 'string') return '';
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, (m) => map[m]);
        };

        // --- Utility Components ---
        const Alert = ({ message, type, onDismiss }) => {
            const getAlertIcon = (type) => {
                switch(type) {
                    case 'success': return 'check-circle';
                    case 'danger': return 'exclamation-triangle';
                    case 'warning': return 'exclamation-circle';
                    case 'info': return 'info-circle';
                    default: return 'info-circle';
                }
            };
            
            useEffect(() => {
                const timer = setTimeout(onDismiss, 5000);
                return () => clearTimeout(timer);
            }, [onDismiss]);

            return (
                <div className={`alert alert-${type} alert-dismissible fade show alert-custom`} role="alert">
                    <i className={`fas fa-${getAlertIcon(type)}`}></i> {message}
                    <button type="button" className="btn-close" onClick={onDismiss}></button>
                </div>
            );
        };

        // --- Main Components ---
        const Header = () => (
            <>
                <nav className="navbar-admin">
                    <div className="d-flex justify-content-between align-items-center w-100">
                        <span className="navbar-brand mb-0">ðŸ”’ Portfolio Admin Panel</span>
                        <a href="index.html" className="back-to-portfolio">
                            <i className="fas fa-arrow-left"></i> Back to Portfolio
                        </a>
                    </div>
                </nav>
                <div className="admin-header">
                    <h1 className="admin-title">ðŸ“§ Contact Form Responses</h1>
                    <p className="admin-subtitle">Manage all contact form submissions from your portfolio</p>
                    <div className="text-muted">
                        <i className="fas fa-shield-alt"></i> Private Admin Area - Not accessible to public visitors
                    </div>
                </div>
            </>
        );

        const StatsCards = ({ responses }) => {
            const stats = useMemo(() => {
                const active = responses.filter(r => r.status === 'active').length;
                const trash = responses.filter(r => r.status === 'deleted').length;
                const total = responses.length;
                const today = responses.filter(r => new Date(r.timestamp).toDateString() === new Date().toDateString()).length;
                return { active, trash, total, today };
            }, [responses]);

            return (
                <div className="stats-cards">
                    <div className="stat-card">
                        <div className="stat-number active-stat">{stats.active}</div>
                        <div className="stat-label">Active Messages</div>
                    </div>
                    <div className="stat-card">
                        <div className="stat-number trash-stat">{stats.trash}</div>
                        <div className="stat-label">In Trash</div>
                    </div>
                    <div className="stat-card">
                        <div className="stat-number total-stat">{stats.total}</div>
                        <div className="stat-label">Total Received</div>
                    </div>
                    <div className="stat-card">
                        <div className="stat-number today-stat">{stats.today}</div>
                        <div className="stat-label">Today</div>
                    </div>
                </div>
            );
        };

        const MessageModal = ({ message, onHide, onReply }) => {
            if (!message) return null;

            const modalRef = React.useRef();
            
            useEffect(() => {
                const modalElement = modalRef.current;
                const bsModal = new bootstrap.Modal(modalElement, {
                    keyboard: false
                });
                bsModal.show();
                modalElement.addEventListener('hidden.bs.modal', onHide);
                return () => {
                    if (bsModal._isShown) {
                        bsModal.hide();
                    }
                    modalElement.removeEventListener('hidden.bs.modal', onHide);
                };
            }, [message, onHide]);

            return (
                <div className="modal fade" id="messageModal" ref={modalRef} tabIndex="-1">
                    <div className="modal-dialog modal-lg">
                        <div className="modal-content">
                            <div className="modal-header">
                                <h5 className="modal-title">Message Details</h5>
                                <button type="button" className="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div className="modal-body">
                                <div className="row">
                                    <div className="col-md-6">
                                        <h6 className="text-primary">Contact Information</h6>
                                        <p><strong>Name:</strong> {escapeHtml(message.name)}</p>
                                        <p><strong>Email:</strong> <a href={`mailto:${message.email}`}>{escapeHtml(message.email)}</a></p>
                                        <p><strong>Subject:</strong> {escapeHtml(message.subject)}</p>
                                        <p><strong>Newsletter:</strong> {message.newsletter ? 'Yes' : 'No'}</p>
                                    </div>
                                    <div className="col-md-6">
                                        <h6 className="text-primary">Message Details</h6>
                                        <p><strong>Received:</strong> {formatDate(message.timestamp)}</p>
                                        <p><strong>Status:</strong>
                                            <span className={`badge ${message.status === 'active' ? 'bg-success' : 'bg-danger'}`}>
                                                {message.status === 'active' ? 'Active' : 'In Trash'}
                                            </span>
                                        </p>
                                    </div>
                                </div>
                                <hr />
                                <h6 className="text-primary">Full Message</h6>
                                <div className="border rounded p-3 bg-light">
                                    <p className="mb-0" dangerouslySetInnerHTML={{ __html: escapeHtml(message.message).replace(/\n/g, '<br>') }}></p>
                                </div>
                            </div>
                            <div className="modal-footer">
                                <button type="button" className="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" className="btn btn-primary" onClick={() => onReply(message)}>
                                    <i className="fas fa-reply"></i> Reply via Email
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const EmptyState = ({ icon, title, children }) => (
            <tr>
                <td colSpan="7">
                    <div className="empty-state">
                        <i className={`fas fa-${icon}`}></i>
                        <h4>{title}</h4>
                        <p>{children}</p>
                    </div>
                </td>
            </tr>
        );

        const ActiveResponses = ({ responses, filters, onFilterChange, onAction, subjects }) => {
            const filteredResponses = (responses || []).filter(r => {
                const searchTerm = filters.search.toLowerCase();
                const searchMatch = !searchTerm || r.name.toLowerCase().includes(searchTerm) || r.email.toLowerCase().includes(searchTerm) || r.message.toLowerCase().includes(searchTerm);
                const subjectMatch = !filters.subject || r.subject === filters.subject;
                const dateMatch = !filters.date || (() => {
                    const now = new Date();
                    const messageDate = new Date(r.timestamp);
                    switch (filters.date) {
                        case 'today': return messageDate.toDateString() === now.toDateString();
                        case 'week': return messageDate >= new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        case 'month': return messageDate >= new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                        default: return true;
                    }
                })();
                return searchMatch && subjectMatch && dateMatch;
            });

            return (
                <div className="section-card">
                    <h3 className="section-title"><i className="fas fa-inbox"></i> Active Messages</h3>
                    <div className="filter-controls">
                        <div className="search-box">
                            <div className="input-group">
                                <span className="input-group-text"><i className="fas fa-search"></i></span>
                                <input type="text" className="form-control" placeholder="Search messages..." value={filters.search} onChange={e => onFilterChange('search', e.target.value)} />
                            </div>
                        </div>
                        <select className="form-select" style={{ maxWidth: '200px' }} value={filters.subject} onChange={e => onFilterChange('subject', e.target.value)}>
                            <option value="">All Subjects</option>
                            {subjects.map(s => <option key={s} value={s}>{s}</option>)}
                        </select>
                        <select className="form-select" style={{ maxWidth: '150px' }} value={filters.date} onChange={e => onFilterChange('date', e.target.value)}>
                            <option value="">All Dates</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                        </select>
                    </div>
                    <div className="quick-actions">
                        <button className="btn btn-outline-primary btn-sm" onClick={() => onAction('refresh')}><i className="fas fa-sync-alt"></i> Refresh</button>
                        <button className="btn btn-outline-success btn-sm" onClick={() => onAction('export')}><i className="fas fa-download"></i> Export CSV</button>
                        <button className="btn btn-outline-danger btn-sm" onClick={() => onAction('clearTrash')}><i className="fas fa-trash-alt"></i> Clear All Trash</button>
                    </div>
                    <div className="table-container">
                        <table className="table table-hover response-table">
                            <thead>
                                <tr>
                                    <th>Date & Time</th><th>Name</th><th>Email</th><th>Subject</th><th>Message Preview</th><th>Newsletter</th><th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {filteredResponses.length > 0
                                    ? filteredResponses.map(response => (
                                        <tr key={response.id} className="response-row">
                                            <td><small className="text-muted">{formatDate(response.timestamp)}</small></td>
                                            <td><strong>{escapeHtml(response.name)}</strong></td>
                                            <td><a href={`mailto:${response.email}`} className="text-decoration-none">{escapeHtml(response.email)}</a></td>
                                            <td><span className="badge bg-primary">{escapeHtml(response.subject)}</span></td>
                                            <td>
                                                <div className="message-preview" onClick={() => onAction('view', response)}>
                                                    {escapeHtml(response.message.substring(0, 50))}{response.message.length > 50 ? '...' : ''}
                                                </div>
                                            </td>
                                            <td>{response.newsletter ? <span className="badge bg-success">Yes</span> : <span className="badge bg-secondary">No</span>}</td>
                                            <td>
                                                <button className="btn btn-primary btn-action btn-view" title="View Full Message" onClick={() => onAction('view', response)}><i className="fas fa-eye"></i></button>
                                                <button className="btn btn-success btn-action btn-reply" title="Reply via Email" onClick={() => onAction('reply', response)}><i className="fas fa-reply"></i></button>
                                                <button className="btn btn-danger btn-action btn-delete" title="Move to Trash" onClick={() => onAction('delete', response)}><i className="fas fa-trash"></i></button>
                                            </td>
                                        </tr>
                                    ))
                                    : <EmptyState icon="search" title="No Messages Found">
                                          {(!responses || responses.length === 0) ? "No active messages received yet." : "No messages match your current filters."}
                                      </EmptyState>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const TrashResponses = ({ responses, onAction }) => (
            <div className="section-card">
                <h3 className="section-title"><i className="fas fa-trash"></i> Trash Bin</h3>
                <div className="table-container">
                    <table className="table table-hover response-table">
                        <thead>
                            <tr>
                                <th>Date & Time</th><th>Name</th><th>Email</th><th>Subject</th><th>Message Preview</th><th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {responses && responses.length > 0
                                ? responses.map(response => (
                                    <tr key={response.id} className="response-row">
                                        <td><small className="text-muted">{formatDate(response.timestamp)}</small></td>
                                        <td><strong>{escapeHtml(response.name)}</strong></td>
                                        <td>{escapeHtml(response.email)}</td>
                                        <td><span className="badge bg-secondary">{escapeHtml(response.subject)}</span></td>
                                        <td>
                                            <div className="message-preview" onClick={() => onAction('view', response)}>
                                                {escapeHtml(response.message.substring(0, 50))}{response.message.length > 50 ? '...' : ''}
                                            </div>
                                        </td>
                                        <td>
                                            <button className="btn btn-primary btn-action btn-view" title="View Full Message" onClick={() => onAction('view', response)}><i className="fas fa-eye"></i></button>
                                            <button className="btn btn-warning btn-action btn-restore" title="Restore to Active" onClick={() => onAction('restore', response)}><i className="fas fa-undo"></i></button>
                                            <button className="btn btn-dark btn-action btn-permanent" title="Delete Permanently" onClick={() => onAction('permanentDelete', response)}><i className="fas fa-times"></i></button>
                                        </td>
                                    </tr>
                                ))
                                : <EmptyState icon="trash-alt" title="Trash is Empty">No deleted messages in trash bin.</EmptyState>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        );

        // --- App Component ---
        function App() {
            const [responses, setResponses] = useState([]);
            const [filters, setFilters] = useState({ search: '', subject: '', date: '' });
            const [selectedMessage, setSelectedMessage] = useState(null);
            const [alerts, setAlerts] = useState([]);

            const loadResponses = useCallback(() => {
                try {
                    const stored = localStorage.getItem('portfolioResponses');
                    let loadedResponses = stored ? JSON.parse(stored) : [];
                    // Ensure demo data is present if local storage is empty
                    if (loadedResponses.length === 0) {
                        loadedResponses = [...initialDemoData];
                    }
                    setResponses(loadedResponses);
                } catch (error) {
                    console.error("Failed to load responses:", error);
                    createAlert("Failed to load data. It might be corrupted.", "danger");
                    setResponses([...initialDemoData]);
                }
            }, []);

            const saveResponses = (newResponses) => {
                try {
                    localStorage.setItem('portfolioResponses', JSON.stringify(newResponses));
                    setResponses(newResponses);
                    window.dispatchEvent(new CustomEvent('storage-updated'));
                } catch (error) {
                    console.error("Failed to save responses:", error);
                    createAlert("Failed to save data.", "danger");
                }
            };
            
            useEffect(() => {
                loadResponses();
                const handleStorageChange = () => {
                    loadResponses();
                };
                window.addEventListener('storage-updated', handleStorageChange);
                window.addEventListener('storage', handleStorageChange);
                return () => {
                    window.removeEventListener('storage-updated', handleStorageChange);
                    window.removeEventListener('storage', handleStorageChange);
                };
            }, [loadResponses]);
            
            const createAlert = (message, type) => {
                const id = Date.now();
                setAlerts(prev => [...prev, { id, message, type }]);
            };

            const handleFilterChange = (key, value) => {
                setFilters(prev => ({ ...prev, [key]: value }));
            };

            const handleAction = (action, payload) => {
                switch(action) {
                    case 'view':
                        setSelectedMessage(payload);
                        break;
                    case 'reply':
                        const subject = `Re: ${payload.subject}`;
                        const body = `Hi ${payload.name},\n\nThank you for reaching out.\n\n---\nOriginal Message:\n"${payload.message}"\n---\n\nBest regards,\nSumit Gaikwad`;
                        window.open(`mailto:${payload.email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`, '_blank');
                        createAlert('Email client opened for reply', 'success');
                        break;
                    case 'delete':
                        if (confirm('Move this message to trash?')) {
                            const updated = responses.map(r => r.id === payload.id ? { ...r, status: 'deleted' } : r);
                            saveResponses(updated);
                            createAlert('Message moved to trash', 'warning');
                        }
                        break;
                    case 'restore':
                        const restored = responses.map(r => r.id === payload.id ? { ...r, status: 'active' } : r);
                        saveResponses(restored);
                        createAlert('Message restored successfully', 'success');
                        break;
                    case 'permanentDelete':
                        if (confirm('Permanently delete this message? This action cannot be undone!')) {
                            const remaining = responses.filter(r => r.id !== payload.id);
                            saveResponses(remaining);
                            createAlert('Message permanently deleted', 'danger');
                        }
                        break;
                    case 'refresh':
                        loadResponses();
                        setFilters({ search: '', subject: '', date: '' });
                        createAlert('Data refreshed', 'info');
                        break;
                    case 'export':
                        const active = responses.filter(r => r.status === 'active');
                        if (active.length === 0) {
                            createAlert('No active responses to export', 'warning');
                            return;
                        }
                        const headers = ['Date', 'Name', 'Email', 'Subject', 'Message', 'Newsletter'];
                        const csvContent = [
                            headers.join(','),
                            ...active.map(r => [r.timestamp, `"${r.name}"`, r.email, `"${r.subject}"`, `"${r.message.replace(/"/g, '""')}"`, r.newsletter ? 'Yes' : 'No'].join(','))
                        ].join('\n');
                        const blob = new Blob([csvContent], { type: 'text/csv' });
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `portfolio_responses_${new Date().toISOString().split('T')[0]}.csv`;
                        a.click();
                        window.URL.revokeObjectURL(url);
                        createAlert('CSV file downloaded', 'success');
                        break;
                    case 'clearTrash':
                        const trashCount = responses.filter(r => r.status === 'deleted').length;
                        if (trashCount === 0) {
                            createAlert('Trash is already empty', 'info');
                            return;
                        }
                        if (confirm(`Permanently delete all ${trashCount} messages in trash?`)) {
                            const activeOnly = responses.filter(r => r.status !== 'deleted');
                            saveResponses(activeOnly);
                            createAlert(`${trashCount} messages permanently deleted`, 'danger');
                        }
                        break;
                }
            };
            
            const activeResponses = useMemo(() => responses.filter(r => r.status === 'active'), [responses]);
            const trashResponses = useMemo(() => responses.filter(r => r.status === 'deleted'), [responses]);
            const subjects = useMemo(() => [...new Set(responses.map(r => r.subject).filter(Boolean))], [responses]);

            return (
                <>
                    <Header />
                    <StatsCards responses={responses} />
                    <div id="alertArea">
                        {alerts.map(alert => <Alert key={alert.id} {...alert} onDismiss={() => setAlerts(p => p.filter(a => a.id !== alert.id))} />)}
                    </div>
                    <ActiveResponses
                        responses={activeResponses}
                        filters={filters}
                        onFilterChange={handleFilterChange}
                        onAction={handleAction}
                        subjects={subjects}
                    />
                    <TrashResponses
                        responses={trashResponses}
                        onAction={handleAction}
                    />
                    {selectedMessage && <MessageModal message={selectedMessage} onHide={() => setSelectedMessage(null)} onReply={handleAction.bind(null, 'reply')} />}
                </>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>